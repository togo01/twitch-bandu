<!DOCTYPE html>
<html lang='zh-tw' style='overflow: hidden;' xml:lang='zh-tw' xmlns:fb='http://www.facebook.com/2008/fbml' xmlns:og='http://opengraphprotocol.org/schema/' xmlns='http://www.w3.org/1999/xhtml'>

<head>
    <meta charset="utf-8">
    <title>twitch chat with tts</title>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css">
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="bookmark" href="/favicon.ico" />
    <link href="https://fonts.googleapis.com/css?family=Germania+One|Baloo+Thambi|Press+Start+2P" rel="stylesheet">
    <style type="text/css">
         ::-webkit-scrollbar {
            background-color: rgb(25, 25, 25);
        }
        
         ::-webkit-scrollbar-thumb {
            background-color: rgb(50, 50, 50);
        }
        
        .scroll {
            position: relative;
            overflow: hidden;
        }
        
        .option {
            color: #999;
            line-height: 30px !important;
            width: -moz-calc(100% - 20px);
            width: -webkit-calc(100% - 20px);
            width: calc(100% - 20px);
            background-color: rgb(30, 30, 30);
            border-bottom: 1px solid rgb(0, 0, 0) !important;
            padding-left: 10px !important;
            padding-right: 10px !important;
            padding-top: 3px !important;
            padding-bottom: 2px !important;
            box-shadow: 0px 1px 0px rgba(255, 255, 255, 0.04) inset !important;
        }
        
        .switch-label {
            position: relative;
            z-index: 2;
            float: left;
            width: 60px;
            line-height: 26px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.35);
            text-align: center;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.45);
            cursor: pointer;
            border-radius: 5px;
            margin: 0px
        }
        
        #msellist select {
            padding: 0px;
            margin: 0;
            background-color: rgb(35, 35, 35);
            color: #D3D3D3;
            height: 25px;
            vertical-align: top;
            border: 0
        }
        
        .option textarea {
            padding: 2px;
            margin: 0;
        }
        
        .option button {
            min-height: 2em
        }
        
        .closebutton:hover {
            cursor: pointer;
        }
        
        .ircline {
            padding: 2px;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 24px!important;
            line-height: 26px!important;
            text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
            letter-spacing: 1px;
            font-variant: normal;
            font-weight: bold;
            font-style: normal;
            color: #fff;
        }
        
        ruby {
            font-family: 'Helvetica Neue', 'Germania One', Helvetica, Arial, sans-serif;
        }
        
        rt {
            font-family: 'Press Start 2P', cursive;
        }
        
        .message {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif, Meiryo, "微軟正黑體", Microsoft JhengHei;
            text-shadow: #000 0px 0px 1px, #000 0px 0px 1px, #000 0px 0px 1px, #000 0px 0px 1px, #000 0px 0px 1px, #000 0px 0px 1px;
        }
        
        #chat_box {
            height: calc(100% - 13px);
            overflow: hidden;
            position: absolute;
        }
        
        #maudio {
            position: relative;
            left: 10px;
            top: 4px;
            width: 670px;
        }
        
        audio::-webkit-media-controls-panel {
            background-color: rgb(35, 35, 35);
            color: rgb(211, 211, 211);
        }
        
        audio::-webkit-media-controls-mute-button,
        audio::-webkit-media-controls-play-button {
            color: rgb(211, 211, 211);
        }
        
        img {
            margin: 0px;
            padding: 0px;
            vertical-align: middle;
            height: 25px;
        }
        
        a {
            color: #AAAAAA;
        }
        
        @keyframes scrollclip {
            from {
                clip-path: polygon(0% 0%, 1% 0%, 1% 100%, 0% 100%);
            }
            to {
                clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
            }
        }
    </style>
    <script src="index.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <script type="text/javascript">
        //https://ttv-api.s3.amazonaws.com/twitch.min.js

        window.onload = function() {

            var audioIndex = {};
            var audioList = [];
            var audioLibrary = {};
            var build = 0;

            var bot = null;
            var username = 'justinfan12345';
            var oauth = 'blah';

            var msgarray = new Array();
            var selist = [];
            var cd = true;

            loadAudioList();
            setInterval(loadAudioList, 10000);

            function loadAudioList() {
                $.ajax({
                    type: "get",
                    url: "audio.json",
                    dataType: "json",
                    cache: false,
                    success: function(json) {
                        if (json.build != build) {
                            audioIndex = json.index;
                            audioList = json.audio;
                            audioLibrary = json.library;
                            build = json.build;
                        }
                    }
                });
            }

            function getAudioFromLibrary(msg) {
                if (audioList.indexOf(msg) == -1)
                    return null;
                if (!msg in audioLibrary)
                    return null;
                var audios = audioLibrary[msg];
                return audios[Math.floor(Math.random() * audios.length)];
            }


            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, '\\$&');
                var regex = new RegExp('[#?&]' + name + '(=([^&#]*)|&|#|$)'),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }

            const audio = document.getElementById('maudio');
            var isPlayingAudio = false;
            audio.onloadstart = function() {
                // console.log('Audio LoadStart');
            }
            audio.onloadeddata = function() {
                // console.log('Audio Loaded Data');
            }
            audio.play = function() {
                // console.log('Audio Play');
            }
            audio.onended = function() {
                isPlayingAudio = false;
                // console.log('Audio Ended');
            }


            if (window.location.toString().indexOf("#") != -1 && window.location.toString().indexOf("channel=") != -1) {
                //	var channel=window.location.toString().split("#")[1].split("&")[0];
                //	var engine=window.location.toString().split("#")[1].split("&")[1];
                //	var itriconfig=window.location.toString().split("#")[1].split("&")[2];
                //	var volume=window.location.toString().split("#")[1].split("&")[3];
                //	var banlist=window.location.toString().split("#")[1].split("&")[4];

                var channel = getParameterByName('channel');
                var engine = getParameterByName('engine');
                var itriconfig = getParameterByName('itriconfig');
                var volume = getParameterByName('volume');
                var banlist = getParameterByName('banlist');
                var se = getParameterByName('se');
                var cdsec = getParameterByName('cdsec');

                $("#channel_textarea").val(channel);
                $("#banlist_textarea").val(banlist);
                $("#cdsec_textarea").val(cdsec);
                if (engine == "itri") {

                    $("#enginelabel2").animate({
                        backgroundColor: "#FF0000",
                        color: "rgba(0, 0, 0, 0.5)"
                    }, 1000);
                    $("#enginelabel1").animate({
                        backgroundColor: "rgba(1,1,1,0)",
                        color: "rgba(255, 255, 255, 0.35)"
                    }, 1000);

                }

                if (se == "on") {

                    $("#sclabel1").animate({
                        backgroundColor: "#FF0000",
                        color: "rgba(0, 0, 0, 0.5)"
                    }, 1000);
                    $("#sclabel2").animate({
                        backgroundColor: "rgba(1,1,1,0)",
                        color: "rgba(255, 255, 255, 0.35)"
                    }, 1000);

                }

                var itriconfar = "TW_SPK_AKoan,0,0,0,5".split(',');
                jQuery("#ttsspeaker").val(itriconfar[0]);
                jQuery("#speed").val(itriconfar[1]);
                jQuery("#pitchlevel").val(itriconfar[2]);
                jQuery("#pitchsign").val(itriconfar[3]);
                jQuery("#pitchscale").val(itriconfar[4]);

                $("audio").prop("volume", volume);
                //	 $("#slider").slider( "value", volume*100);

            } else {
                var channel = "";
                var engine = "google";
                var itriconfig = "TW_SPK_AKoan,0,0,0,5";
                var volume = 0.6;
                var banlist = "nightbot";
                var se = "on";
                var cdsec = "25";
                $("#banlist_textarea").val("nightbot")
                $("#cdsec_textarea").val("25");
                $("audio").prop("volume", volume);
                //	 $("#slider").slider( "value", volume*100);

            }

            if (channel != null && channel != "") {
                connect();
            }
            $('#settingpage').show("slow");


            function lanTest(msg) {
                var recht = /[\u4e00-\u9fa5]/;
                var rejp = /[\u3041-\u30fa]/;
                var pattern = /[\u3105-\u3129\u02CA\u02C7\u02CB\u02D9]/; //注音符號 Unicode 範圍
                language = 'en_us';

                if (recht.test(msg) || pattern.test(msg)) {
                    language = 'zh_cn';
                }
                if (rejp.test(msg)) {
                    language = 'ja';
                }
                return language;
            }

            function filter(msg) {
                msg = msg.replace("0.0", "傻眼貓咪");
                msg = msg.replace(/([\>\<\.@дω\*\~_\?\^\#])+/gi, "");
                msg = msg.replace(/.*◕.*/g, "");
                msg = msg.replace(/([^A-Za-z])[w|W]$\1/, "哇啦");
                msg = msg.replace(/www*/gi, "哇啦哇啦");
                msg = msg.replace(/XD+/gi, "插滴");
                msg = msg.replace(/https?:\/\/.*/g, "連結懶得念");
                msg = msg.replace(/.*bschk.*/g, "");
                msg = msg.replace(/.*pv zk.*/g, "");
                msg = msg.replace(/.*艮心丟醫.*/g, "艮心丟醫以下省略");
                msg = msg.replace(/(她媽|他媽|它媽|祂媽)/g, "他插")

                if (msg.replace(/8/g, "") == "") {
                    msg = msg.replace(/8/g, "八 ");
                }

                msg = msg.replace(/^!.*/g, "");

                //	for(i=0;i<(msg.length-3);i++){
                ///    	if( msg.charAt(i)==msg.charAt(i+1)&&msg.charAt(i+1)==msg.charAt(i+2)&&msg.charAt(i+1)==msg.charAt(i+3)){
                //     		msg="";      
                // 		}  
                //	}
                var spam = false;

                //     		for(var i=0;i<(msg.length);i++){
                //     			var j = 0;
                //     			for(var k=0;k<(msg.length);k++){
                //     				if(msg.charAt(i)==msg.charAt(k)){j++;}
                //     			}
                //     			if (j>8){
                //     				spam = true;
                //     			} 
                //     		}
                //        		if(spam){msg="";}


                // console.log(msg);

                return msg;

            }

            function updateurl() {

                if (window.location.toString().indexOf("access_token") != -1) {
                    document.location.href = window.location.toString().split("bearer")[0] + "bearer&channel=" + channel + "&engine=" + engine + "&volume=" + volume + "&banlist=" + banlist + "&se=" + se;
                } else {
                    document.location.href = "#&channel=" + channel + "&engine=" + engine + "&volume=" + volume + "&banlist=" + banlist + "&se=" + se;
                }
            }

            function CoolDown() {
                cd = true;
            }

            function connect() {
                bot = new twitchIRC(username, oauth, {
                    "channels": ["#" + channel],
                    "whispers": true
                });
                bot.on("message_with_tags", function(channel_f, user, message, tags) {

                    var messageWitoutEmoji = "";
                    var banlistsrray = banlist.split(",");
                    var emotrarr;
                    var emotrarr2 = [];
                    if (tags["emotes"]) {
                        var emotrarr = tags["emotes"].split("/");
                        for (var i in emotrarr) {
                            if (emotrarr.hasOwnProperty(i)) {
                                var emonum = emotrarr[i].split(":")[0];
                                var index = emotrarr[i].split(":")[1];
                                var indexarr = index.split(",")
                                for (var k in indexarr) {
                                    var index0 = indexarr[k].split("-")[0];
                                    var index1 = indexarr[k].split("-")[1];
                                    emotrarr2.push([index0, index1, emonum]);
                                }
                            }
                        }
                    }
                    var displaynamefix = tags["display-name"];
                    if (user.toLowerCase() == tags["display-name"].toLowerCase() || tags["display-name"] == "") {
                        displaynamefix = "";
                    }
                    var ircline = $("<div></div>").addClass('ircline');
                    var color = tags["color"];
                    if (color) {
                        var red = 255 - parseInt(color.substring(1, 3), 16);
                        var green = 255 - parseInt(color.substring(3, 5), 16);
                        var bule = 255 - parseInt(color.substring(5, 7), 16);
                        var colorrgb = "rgb(" + red + "," + green + "," + bule + ")"; //算出補色
                        var namespan = $('<span></span>').css("color", color).css("text-shadow", "-1px -1px 0 " + colorrgb + ", 1px -1px 0 " + colorrgb + ", -1px 1px 0 " + colorrgb + ", 1px 1px 0 " + colorrgb);
                    } else {
                        var namespan = $('<span></span>').css("color", "#FFFFFF").css("text-shadow", "-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000");
                    }
                    if (displaynamefix != "") {
                        var ruby = $('<ruby></ruby>').text(displaynamefix);
                        var rt = $('<rt></rt>').text(user);
                        //ircline.css("padding-top","7px");
                        ruby.append(rt);
                    } else {
                        var ruby = $('<ruby></ruby>').text(user);
                    }
                    var llspan = $('<span></span>').text(':');
                    var msgspan = $('<span></span>').addClass('message');
                    var afterstr = "";
                    for (var i = 0; i < message.length; i++) {
                        if (emotrarr2.length != 0) {
                            var haskappa = false;
                            for (var j in emotrarr2) {
                                if (emotrarr2[j][0] == i) {
                                    var img = "<img src=\"http://static-cdn.jtvnw.net/emoticons/v1/" + emotrarr2[j][2] + "/1.0\" />"
                                    afterstr += img;
                                    haskappa = true;
                                    i = i + (emotrarr2[j][1] - emotrarr2[j][0]);
                                }

                            }
                            if (!haskappa) {
                                afterstr += message.charAt(i);
                                messageWitoutEmoji += message.charAt(i);
                            }
                        } else {
                            afterstr += message.charAt(i);
                            messageWitoutEmoji += message.charAt(i);
                        }
                    }
                    msgspan.append(afterstr);
                    namespan.append(ruby);
                    ircline.append(namespan);
                    ircline.append(llspan);
                    ircline.append(msgspan);
                    if ($('.ircline').size() >= 30) {
                        $('.ircline').first().remove();
                    }
                    $("#chat_box").append(ircline.css("animation", "scrollclip 1s"));

                    //	while ($("#chat_box").height() > $("body").height()){
                    //		$('.ircline').first().remove();
                    //	}
                    $('#chat_box')[0].scrollTop = $('#chat_box')[0].scrollHeight;

                    if (banlistsrray.indexOf(user) == -1) {

                        // sometimes the name of character you mention is too hard to connect in Chinese. haha. they are trying hard to figure out.

                        messageWitoutEmoji = messageWitoutEmoji.trim();
                        messageWitoutEmoji = filter(messageWitoutEmoji);

                        if (messageWitoutEmoji.length > 0 && lanTest(messageWitoutEmoji) == "en_us") {
                            var translate = "";
                            $.ajax({
                                type: "post",
                                url: "https://translation.googleapis.com/language/translate/v2?key=AIzaSyAZ2ojMmYwZH79266LWN7EVHhsSV8HcYfI",
                                dataType: "json",
                                data: {
                                    q: messageWitoutEmoji,
                                    source: "en",
                                    target: "zh-TW",
                                    format: "text"
                                },
                                cache: false,
                                success: function(json) {
                                    if ("data" in json) {
                                        if ("translations" in json["data"]) {
                                            if (Array.isArray(json["data"]["translations"]) && json["data"]["translations"].length > 0) {
                                                translate = json["data"]["translations"][Math.floor(Math.random() * json["data"]["translations"].length)]["translatedText"];
                                            }
                                        }
                                    }
                                }
                            }).always(function() {
                                if (translate != "" && lanTest(translate) != "en_us") {
                                    ProcessMessageToQueue("翻譯蒟蒻");
                                    ProcessMessageToQueue(translate);
                                } else {
                                    ProcessMessageToQueue(message);
                                }
                            });
                        } else {
                            ProcessMessageToQueue(message);
                        }


                    }
                });

                function ProcessMessageToQueue(message) {

                    var messageLength = 0;
                    var messageIsNotFull = true;
                    var messageInSize = "";
                    var messageIsTooLong = false;
                    for (var i = 0; i < message.length; i++) {
                        var spaceAt = message.indexOf(' ', i);
                        if (spaceAt < 0) {
                            spaceAt = message.length;
                        }
                        var word = message.substring(i, spaceAt);
                        var thisWordLen = word.length;
                        var wordLeng = lanTest(word);
                        if (wordLeng == 'en_us') {
                            if (word >= 10) {
                                thisWordLen = 3;
                            } else if (word >= 5) {
                                thisWordLen = 2;
                            } else {
                                thisWordLen = 1;
                            }
                        }

                        if (messageIsNotFull) {
                            if (wordLeng == 'en_us') {
                                messageInSize += word + " ";
                            } else {
                                var leftSpace = 35 - messageLength;
                                if (thisWordLen <= leftSpace) {
                                    messageInSize += word.substring(0, leftSpace) + " ";
                                }
                            }
                        }

                        messageLength += thisWordLen;
                        if (messageLength >= 35) {
                            messageIsTooLong = true;
                            break;
                        }
                        i = spaceAt;
                    }

                    message = messageInSize.trim();

                    if (se == "on") {

                        var processStar = 0;
                        var stringBuffer = "";
                        for (i = 0; i < message.length; i++) {
                            var currentChar = message.charAt(i);
                            if (!(currentChar in audioIndex))
                                continue;
                            if (!Array.isArray([currentChar]))
                                continue;

                            var isMatch = false;
                            var matchAudio = null;

                            for (j = 0; j < audioIndex[currentChar].length; j++) {
                                if (message.indexOf(audioIndex[currentChar][j], i) == i) {
                                    isMatch = true;
                                    matchAudio = audioIndex[currentChar][j];
                                    break;
                                }
                            }

                            if (!isMatch)
                                continue;

                            if (i - processStar > 0) {
                                var normalMessage = filter(message.substring(processStar, i));
                                if (normalMessage != "") {
                                    msgarray.push("https://ttsproxy1.appspot.com/" + normalMessage + "?tl=" + lanTest(normalMessage) + "&engine=" + engine + "&itriconf=" + itriconfig);
                                }
                            }

                            var audioMessage = getAudioFromLibrary(matchAudio);
                            if (audioMessage != null) {
                                msgarray.push("https://togo01.github.io/twitch-bandu/audio/" + audioMessage);
                                i += matchAudio.length - 1;
                                processStar = i + 1;
                            }

                        }

                        if (processStar >= message.length)
                            return;

                        message = message.substring(processStar);

                        var audioMsg = getAudioFromLibrary(message);
                        if (audioMsg != null) {
                            msgarray.push("https://togo01.github.io/twitch-bandu/audio/" + audioMsg);
                            return;
                        }

                    }

                    var msg = filter(message);
                    if (msg != "") {
                        msgarray.push("https://ttsproxy1.appspot.com/" + msg + "?tl=" + lanTest(msg) + "&engine=" + engine + "&itriconf=" + itriconfig);
                        if (msg == "滾滾") {
                            msgarray.push("https://togo01.github.io/twitch-bandu/audio/嘿右.mp3");
                        } else if (messageIsTooLong) {
                            msgarray.push("https://ttsproxy1.appspot.com/太長唸完會嘴酸?tl=zh_cn&engine=" + engine + "&itriconf=" + itriconfig);
                        }
                    }

                }

                bot.on("join", function(channel_f, user) {
                    //console.log(channel_f);
                    //console.log(user);
                    if (user == "justinfan12345") {
                        var txt2 = $("<div class=\"ircline\"></div>").text("成功登入" + channel_f);
                        $("#chat_box").append(txt2);
                        $("#chat_box")[0].scrollTop = $("#chat_box").prop("scrollHeight");
                    }
                });
                bot.on("part", function(channel_f, user) {
                    //console.log(channel_f);
                    //console.log(user);
                    if (user == "justinfan12345") {
                        var txt2 = $("<div class=\"ircline\"></div>").text("成功登出" + channel_f);
                        $("#chat_box").append(txt2);
                        $("#chat_box")[0].scrollTop = $("#chat_box").prop("scrollHeight");
                    }
                });


            }

            $("body").bind('keypress', function(e) {
                if (e.keyCode == 13) {
                    $('#settingpage').toggle("slow");
                }
            });




            /*
            $("#channel_textarea").bind('keypress', function(e) {
            	if(e.keyCode==27){
            		channel=$("#channel_textarea").val();
            		connect();
            		updateurl();
            	}
            });
             */
            $("#channel_button").click(function() {
                //document.location.href="#"+$("#channel_textarea").val();

                if (bot == null) {
                    $("#channel_textarea").val($("#channel_textarea").val().toLowerCase());
                    channel = $("#channel_textarea").val();
                    updateurl();
                    connect();
                } else {
                    bot.part(channel);
                    $("#channel_textarea").val($("#channel_textarea").val().toLowerCase());
                    channel = $("#channel_textarea").val();
                    updateurl();
                    bot.join(channel);
                }

            });

            $("#banlist_button").click(function() {
                //document.location.href="#"+$("#channel_textarea").val();
                $("#banlist_textarea").val($("#banlist_textarea").val().toLowerCase());
                banlist = $("#banlist_textarea").val();
                updateurl();

            });

            $("#enginelabel1").click(function() {
                engine = "google";
                updateurl();

                $("#enginelabel1").animate({
                    backgroundColor: "#FF0000",
                    color: "rgba(0, 0, 0, 0.5)"
                }, 1000);
                $("#enginelabel2").animate({
                    backgroundColor: "rgba(1,1,1,0)",
                    color: "rgba(255, 255, 255, 0.35)"
                }, 1000);


            });

            $("#enginelabel2").click(function() {

                engine = "itri";
                updateurl();

                $("#enginelabel2").animate({
                    backgroundColor: "#FF0000",
                    color: "rgba(0, 0, 0, 0.5)"
                }, 1000);
                $("#enginelabel1").animate({
                    backgroundColor: "rgba(1,1,1,0)",
                    color: "rgba(255, 255, 255, 0.35)"
                }, 1000);

            });

            $("#sclabel1").click(function() {
                se = "on";
                updateurl();
                $("#sclabel1").animate({
                    backgroundColor: "#FF0000",
                    color: "rgba(0, 0, 0, 0.5)"
                }, 1000);
                $("#sclabel2").animate({
                    backgroundColor: "rgba(1,1,1,0)",
                    color: "rgba(255, 255, 255, 0.35)"
                }, 1000);
            });
            $("#sclabel2").click(function() {
                se = "off";
                updateurl();
                $("#sclabel2").animate({
                    backgroundColor: "#FF0000",
                    color: "rgba(0, 0, 0, 0.5)"
                }, 1000);
                $("#sclabel1").animate({
                    backgroundColor: "rgba(1,1,1,0)",
                    color: "rgba(255, 255, 255, 0.35)"
                }, 1000);

            });

            $("#cdsec_button").click(function() {

                cdsec = $("#cdsec_textarea").val();
                updateurl();

            });


            $("#ttsspeaker").change(function() {
                itrionchange();
            });
            $("#speed").change(function() {
                itrionchange();
            });
            $("#pitchlevel").change(function() {
                itrionchange();
            });
            $("#pitchsign").change(function() {
                itrionchange();
            });
            $("#pitchscale").change(function() {
                itrionchange();
            });

            function itrionchange() {
                itriconfig = jQuery("#ttsspeaker").val() + "," + jQuery("#speed").val() + "," + jQuery("#pitchlevel").val() + "," + jQuery("#pitchsign").val() + "," + jQuery("#pitchscale").val();
                updateurl();
            }

            setInterval(speak_runnable, 100);

            // speak_runnable();

            function speak_runnable() {
                if (isPlayingAudio) return;

                if (msgarray[0] && (audio.paused || audio.ended)) {
                    isPlayingAudio = true;
                    audio.src = msgarray[0];
                    audio.autoplay = true;
                    audio.load();
                    msgarray.shift();
                }
            }

            $("#slider").slider({
                min: 0,
                max: 100,
                step: 1,
                change: showValue
            });

            $("#slider").slider("value", volume * 100)

            function showValue(event, ui) {
                $("#volumetext").text("設定發音音量:" + ui.value / 100 + "　　　");
                volume = ui.value / 100;
                $("audio").prop("volume", volume);
                updateurl();
            }

        }
    </script>
</head>

<body>



    <div id=chat_box></div>

    <div id="settingpage" style="display:none;position: absolute; top: 50%; left: 50%; margin-top: -172px; margin-left: -365px; color: rgb(211, 211, 211); width: 730px; height: 345px; z-index: 9002; border-radius: 3px; border: 1px solid rgb(0, 0, 0); box-shadow: rgba(0, 0, 0, 0.298039) -1px 0px 0px, rgba(0, 0, 0, 0.2) -2px 0px 0px, rgba(0, 0, 0, 0.0980392) -3px 0px 0px, rgba(0, 0, 0, 0.298039) 1px 0px 0px, rgba(0, 0, 0, 0.2) 2px 0px 0px, rgba(0, 0, 0, 0.0980392) 3px 0px 0px, rgba(0, 0, 0, 0.298039) 0px -1px 0px, rgba(0, 0, 0, 0.2) 0px -2px 0px, rgba(0, 0, 0, 0.0980392) 0px -3px 0px, rgba(0, 0, 0, 0.298039) 0px 1px 0px, rgba(0, 0, 0, 0.2) 0px 2px 0px, rgba(0, 0, 0, 0.0980392) 0px 3px 0px; background-color: rgb(30, 30, 30);">
        <div style="border-top-left-radius: 3px; border-top-right-radius: 3px; width: 100%; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(17, 17, 17); display: block; height: 45px; background-color: rgb(40, 40, 40);">
            <span class="closebutton" onclick="javascript:(function(){   $('#settingpage').toggle(&quot;slow&quot;);   })();" onmouseover="javascript:(function(){    jQuery( &quot;.closebutton&quot; ).animate({opacity: 0.5}, 500, function() { });   })();" onmouseout="javascript:(function(){    jQuery( &quot;.closebutton&quot;  ).animate({opacity: 0.2}, 500, function() { });   })();"
                style="font-size: 39px; float: right; right: 20px; top: 0px; position: absolute; color: rgb(255, 255, 255); text-shadow: rgb(0, 0, 0) 0px 1px 0px; opacity: 0.2; display: block;">×</span>
        </div>
        <div class="scroll" style="overflow-y: scroll; height: 300px;">
            <div>
                <div class="option">
                    <span style="color: rgb(211, 211, 211); font-family: &quot;Microsoft JhengHei&quot;; font-size: 16px;">設定頻道(twitch帳號)</span>
                    <textarea id="channel_textarea" wrap="wrap" style="color: rgb(211, 211, 211); position: absolute; float: right; right: 65px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Microsoft JhengHei&quot;; box-shadow: none; width: 250px !important; height: 22px !important; border: 1px solid rgb(51, 51, 51) !important; background-color: rgb(20, 20, 20) !important;"></textarea>
                    <button id="channel_button" style="color: rgb(211, 211, 211); position: absolute; float: right; right: 7px; width: 50px !important; height: 28px !important; border: 1px solid rgb(51, 51, 51) !important; background-color: rgb(20, 20, 20) !important;">ok</button>
                </div>
                <div class="option" style="background-color: rgb(35, 35, 35);">
                    <span id="volumetext" style="color: rgb(211, 211, 211); font-family: &quot;Microsoft JhengHei&quot;; font-size: 16px;">設定發音音量:0.6　　　</span>
                    <span id="slider" style="background-color: rgb(35, 35, 35);width:500px;display:inline-block; top:3px "><span>
 			</div>
 			<div class="option" >
 				<span id="banlisttext" style="color: rgb(211, 211, 211); font-family: &quot;Microsoft JhengHei&quot;; font-size: 16px;">禁止發音名單　　ーーー多個用逗點隔開</span>
                    <textarea id="banlist_textarea" wrap="wrap" style="color: rgb(211, 211, 211); position: absolute; float: right; right: 65px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Microsoft JhengHei&quot;; box-shadow: none; width: 250px !important; height: 22px !important; border: 1px solid rgb(51, 51, 51) !important; background-color: rgb(20, 20, 20) !important;"></textarea>
                    <button id="banlist_button" style="color: rgb(211, 211, 211); position: absolute; float: right; right: 7px; width: 50px !important; height: 28px !important; border: 1px solid rgb(51, 51, 51) !important; background-color: rgb(20, 20, 20) !important;">ok</button>


                </div>

                <div class="option" style="background-color: rgb(35, 35, 35); display: none;">
                    <span style="color: rgb(211, 211, 211); font-family: &quot;Microsoft JhengHei&quot;; font-size: 16px;">合成語音引擎</span>
                    <div style="position: relative; float: right; top: 1px; right: 7px; height: 26px; width: 120px; border-radius: 3px; background: rgba(0, 0, 0, 0.247059);">
                        <label id="enginelabel1" class="switch-label" style="color: rgba(0, 0, 0, 0.498039); background-color: rgba(255, 0, 0,1);">google</label>
                        <label id="enginelabel2" class="switch-label">工研院</label>
                    </div>
                </div>

                <div class="option" style="display: none;">
                    <span style="color: rgb(211, 211, 211); font-family: &quot;Microsoft JhengHei&quot;; font-size: 16px;">工研院小姐設定</span>
                    <span id="msellist" style="font-size: 15px; text-align: center; color: rgb(211, 211, 211); width: 555px; height: 26px; position: absolute; float: right; right: 20px; box-shadow: none; z-index: 1; border: 1px solid rgb(51, 51, 51) !important; background-color: rgb(20, 20, 20) !important;">
 				語者 <select id="ttsspeaker" name="ttsspeaker">
 						<option value="Bruce" >Bruce</option>
 						<option value="Theresa">Theresa</option>
 						<option value="Angela">Angela</option>
 						<option value="MCHEN_Bruce">MCHEN_Bruce</option> 
 						<option value="MCHEN_Joddess">MCHEN_Joddess</option>
 						<option value="ENG_Bob">ENG_Bob</option><option value="ENG_Alice">ENG_Alice</option>
 						<option value="ENG_Tracy">ENG_Tracy</option><option value="TW_LIT_AKoan">TW_LIT_AKoan</option>
 						<option value="TW_SPK_AKoan" selected="">TW_SPK_AKoan</option>
 					</select>
 				速度 <select id="speed" name="speed">
 						<option value="10" >10</option>
 						<option value="9">9</option><option value="8">8</option>
 						<option value="7">7</option> <option value="6">6</option>
 						<option value="5">5</option><option value="4">4</option>
 						<option value="3">3</option><option value="2">2</option>
 						<option value="1">1</option><option value="0" selected="">0</option>
 						<option value="-1">-1</option><option value="-2">-2</option>
 						<option value="-3">-3</option><option value="-4">-4</option>
 						<option value="-5">-5</option><option value="-6">-6</option>
 						<option value="-7">-7</option><option value="-8">-8</option>
 						<option value="-9">-9</option><option value="-10">-10</option>
 					</select>
 				音高 <select id="pitchlevel" name="pitchlevel">
 						<option value="10" >10</option>
 						<option value="9">9</option><option value="8">8</option>
 						<option value="7">7</option> <option value="6">6</option>
 						<option value="5">5</option><option value="4">4</option>
 						<option value="3">3</option><option value="2">2</option>
 						<option value="1">1</option><option value="0" selected="">0</option>
 						<option value="-1">-1</option><option value="-2">-2</option>
 						<option value="-3">-3</option><option value="-4">-4</option>
 						<option value="-5">-5</option><option value="-6">-6</option>
 						<option value="-7">-7</option><option value="-8">-8</option>
 						<option value="-9">-9</option><option value="-10">-10</option>
 					</select>
 				說話方式 <select id="pitchsign" name="pitchsign">
 						<option value="0" selected="">正常</option>
 						<option value="1">機器人</option>
 						<option value="2">外國人</option>
 					</select>
 				抑揚頓挫 <select id="pitchscale" name="pitchscale">
 						<option value="20">20</option>
 						<option value="19">19</option>
 						<option value="18">18</option>
 						<option value="17">17</option> 
 						<option value="16">16</option>
 						<option value="15">15</option>
 						<option value="14">14</option>
 						<option value="13">13</option>
 						<option value="12">12</option>
 						<option value="11">11</option>
 						<option value="10">10</option>
 						<option value="9">9</option>
 						<option value="8">8</option>
 						<option value="7">7</option>
 						<option value="6">6</option>
 						<option value="5" selected="">5</option>
 						<option value="4">4</option>
 						<option value="3">3</option>
 						<option value="2">2</option>
 						<option value="1">1</option>
 						<option value="0">0</option>
 					</select>
 				</span>
                </div>

                <div class="option" style="background-color: rgb(35, 35, 35);">
                    <span style="color: rgb(211, 211, 211); font-family: &quot;Microsoft JhengHei&quot;; font-size: 16px;">滾滾語音</span>
                    <div style="position: relative; float: right; top: 1px; right: 7px; height: 26px; width: 120px; border-radius: 3px; background: rgba(0, 0, 0, 0.247059);">
                        <label id="sclabel1" class="switch-label">開</label>
                        <label id="sclabel2" class="switch-label" style="color: rgba(0, 0, 0, 0.498039); background-color: rgba(255, 0, 0,1);">關</label>
                    </div>
                </div>
                <div class="option" style="display: none;">
                    <span style="color: rgb(211, 211, 211); font-family: &quot;Microsoft JhengHei&quot;; font-size: 16px;">特殊語音CD秒數</span>
                    <textarea id="cdsec_textarea" wrap="wrap" style="color: rgb(211, 211, 211); position: absolute; float: right; right: 65px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Microsoft JhengHei&quot;; box-shadow: none; width: 250px !important; height: 22px !important; border: 1px solid rgb(51, 51, 51) !important; background-color: rgb(20, 20, 20) !important;"></textarea>
                    <button id="cdsec_button" style="color: rgb(211, 211, 211); position: absolute; float: right; right: 7px; width: 50px !important; height: 28px !important; border: 1px solid rgb(51, 51, 51) !important; background-color: rgb(20, 20, 20) !important;">ok</button>
                </div>
                <div class="option" 　style="background-color: rgb(35, 35, 35);">
                    <audio controls id="maudio"></audio>
                </div>
            </div>
        </div>

    </div>


</body>

</html>